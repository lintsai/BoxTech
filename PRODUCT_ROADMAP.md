# AI 拳擊訓練分析系統 - 產品路線圖

## 📋 專案概述

**專案名稱**: BoxTech - AI 拳擊訓練分析系統
**專案類型**: AI + Computer Vision + 3D 模擬整合系統
**開發模式**: Vibe Coding + 必要時 Coding
**目標用戶**: 拳擊學員、教練、拳館

---

## 🎯 核心價值主張

1. **個人化訓練分析**: 透過 AI 分析個人拳擊動作,提供客製化改善建議
2. **進度追蹤視覺化**: 日/週/月報表呈現成長曲線
3. **能力評級系統**: 多維度能力分析(六角/五角圖)
4. **對戰模擬訓練**: 模擬不同等級對手,提供策略建議
5. **專項訓練推薦**: 根據弱項推薦針對性訓練課程

---

## 🏗️ 系統架構設計

### 技術棧建議

#### 1. **影片分析引擎**

- **主要選擇**: MediaPipe (Google)

  - ✅ 優勢: 免費、輕量、即時、準確度高
  - ✅ 支援 33 個身體關鍵點追蹤
  - ✅ 可在本地運行,無隱私疑慮
  - ✅ Python/JavaScript SDK 完整
- **備選方案**: OpenPose

  - 適用情境: 需要更高精度的研究場景

#### 2. **AI 分析層**

```
影片輸入 → MediaPipe 姿態估計 → 動作序列提取 
  → 機器學習分類 → 問題點檢測 → 建議生成
```

**模型選擇**:

- **動作分類**: LSTM/GRU (時序動作識別)
- **異常檢測**: Isolation Forest / AutoEncoder
- **建議生成**: GPT-4 Vision API / Claude 3.5 (多模態分析)

#### 3. **資料管理**

- **影片存儲**: 本地 + 雲端備份 (AWS S3 / Azure Blob)
- **結構化資料**: PostgreSQL

  - 訓練記錄表
  - 影片元數據表
  - 分析結果表
  - 用戶進度表
- **向量資料庫**: Pinecone / Milvus

  - 用於 RAG (檢索增強生成)
  - 存儲專家影片特徵向量

#### 4. **後端服務**

- **框架**: FastAPI (Python)
- **任務隊列**: Celery + Redis
- **影片處理**: FFmpeg
- **API 設計**: RESTful + WebSocket (即時反饋)

#### 5. **前端介面**

- **Web**: Next.js + React + TailwindCSS
- **圖表**: Chart.js / D3.js / Recharts
- **影片播放**: Video.js
- **3D 渲染**: Three.js (Web) / Unity WebGL

#### 6. **3D 對戰模擬**

- **引擎**: Unity 3D
- **角色動畫**: Mixamo / 自定義 IK 系統
- **AI 對手**: 行為樹 + 強化學習

---

## 📊 MVP 功能分解

### Phase 0: 基礎建設 (2-3 週)

**目標**: 建立開發環境和基礎架構

#### 里程碑 0.1: 專案初始化

- [X] 建立 Git 版本控制
- [X] 設置虛擬環境 (Python 3.10+)
- [X] 安裝核心依賴
  ```
  - opencv-python
  - mediapipe
  - tensorflow / pytorch
  - fastapi
  - sqlalchemy
  - pandas, numpy
  ```
- [X] 建立專案目錄結構
  ```
  BoxTech/
  ├── backend/
  │   ├── api/
  │   ├── services/
  │   ├── models/
  │   ├── database/
  │   └── utils/
  ├── frontend/
  ├── ml_models/
  ├── scripts/
  ├── Midea/          # 影片資料夾
  └── docs/
  ```

#### 里程碑 0.2: 影片管理系統

- [X] 建立影片元數據資料庫 Schema  ← Day 2-3 已完成（補齊索引，Alembic 遷移）
- [X] 實作影片掃描腳本  ← Day 2-3 已完成（排除 .heic、full/incremental 模式）
  - 自動檢測 Midea 資料夾新影片
  - 提取影片元數據 (日期、時長、解析度)
  - 記錄處理狀態 (未處理/處理中/已完成)
- [X] 實作去重邏輯  ← Day 2 已修正（hash 去重 + 異常報告）
  - 使用檔案 hash 或影片指紋技術
  - 避免重複分析相同影片
- [ ] 建立排程任務系統
  - 每日自動掃描新影片
  - 批次處理佇列

---

### Phase 1: 姿態分析核心 (3-4 週)

**目標**: 能夠從影片中提取拳擊動作骨架數據

#### 里程碑 1.1: MediaPipe 整合

- [ ] 實作影片姿態估計 Pipeline
  - 輸入: MP4/MOV 影片檔案
  - 輸出: 33 個關鍵點的 3D 座標序列 (JSON)
- [ ] 關鍵點資料正規化
  - 座標系轉換 (以髖部為原點)
  - 尺度不變性處理
- [ ] 資料視覺化工具
  - 在影片上繪製骨架覆蓋層
  - 生成動作軌跡圖

#### 里程碑 1.2: 基礎動作識別

- [ ] 標註訓練資料
  - 從您的影片中標註基本動作:
    - Jab (刺拳)
    - Cross (直拳)
    - Hook (勾拳)
    - Uppercut (上勾拳)
    - 泰拳踢
    - 閃避動作
- [ ] 訓練動作分類模型
  - 使用 LSTM 或 Transformer
  - 輸入: 姿態序列 (30 幀)
  - 輸出: 動作類別 + 信心分數
- [ ] 模型評估
  - 準確率 > 85% 為合格
  - 混淆矩陣分析

#### 里程碑 1.3: 動作切割

- [ ] 實作自動動作分段算法
  - 檢測動作開始/結束點
  - 提取單一動作片段
- [ ] 批次處理整支影片
  - 一支影片 → N 個動作片段

**可交付成果**:

- ✅ 影片 → 骨架數據 Pipeline
- ✅ 動作識別 API (`POST /analyze/video`)
- ✅ 視覺化工具 (帶骨架的影片輸出)

---

### Phase 2: 問題檢測與建議 (4-5 週)

**目標**: AI 能指出動作問題並提供改善建議

#### 里程碑 2.1: 動作質量評估

- [ ] 定義評估指標
  ```python
  評估維度:
  1. 姿勢正確性 (站姿、重心)
  2. 出拳軌跡 (是否走直線/最短路徑)
  3. 力量傳遞 (腿 → 腰 → 肩 → 拳)
  4. 收拳速度
  5. 防守姿態 (另一手是否護頭)
  6. 腳步移動
  ```
- [ ] 建立「標準動作」資料庫
  - 從教練示範影片中提取標準模式
  - 計算標準動作的特徵向量
- [ ] 實作偏差檢測算法
  - 計算學員動作與標準動作的差異
  - 使用 DTW (Dynamic Time Warping) 對齊時序
  - 計算關鍵點角度偏差

#### 里程碑 2.2: 問題點視覺化

- [ ] 生成對比影片
  - 左側: 學員動作
  - 右側: 標準動作
  - 顯示差異熱力圖
- [ ] 生成問題點標註
  - 在關鍵幀上用紅色圈出問題部位
  - 顯示偏差角度數值
- [ ] 生成分解圖片序列
  - 將動作分解為 4-8 個關鍵幀
  - 每幀標註問題點

#### 里程碑 2.3: AI 建議生成

- [ ] 整合 GPT-4 Vision / Claude 3.5

  - 輸入: 問題點圖片 + 數據指標
  - Prompt 工程:
    ```
    你是一位專業拳擊教練,分析這個學員的[動作名稱]

    問題數據:
    - 出拳角度偏差: +15°
    - 重心偏移: 前移 8cm
    - 收拳速度: 0.3秒 (標準 0.2秒)

    請提供:
    1. 問題分析 (2-3 句)
    2. 改善建議 (具體動作調整)
    3. 推薦訓練 (2-3 個專項練習)
    ```
  - 輸出: 結構化建議 (JSON + Markdown)
- [ ] 建立建議模板庫

  - 常見問題的標準建議
  - 減少 API 呼叫成本

**可交付成果**:

- ✅ 問題檢測 API (`POST /analyze/problems`)
- ✅ 視覺化報告生成器
- ✅ AI 教練建議文本

---

### Phase 3: 能力評級與報表 (3 週)

**目標**: 多維度評估能力,生成視覺化報表

#### 里程碑 3.1: 六角/五角分析

- [ ] 定義評估維度
  ```yaml
  六角圖維度:
  1. 力量 (Power): 出拳速度 + 動作幅度
  2. 速度 (Speed): 連擊頻率 + 反應時間
  3. 技巧 (Technique): 動作正確率
  4. 防守 (Defense): 護頭比例 + 閃避動作
  5. 體能 (Stamina): 後期動作衰退程度
  6. 步法 (Footwork): 移動範圍 + 重心穩定
  ```
- [ ] 計算各維度分數 (0-100)
- [ ] 生成雷達圖 (Chart.js)

#### 里程碑 3.2: 等級評價系統

- [ ] 定義等級標準
  ```
  Level 1 (初學者):   總分 0-30
  Level 2 (新手):     總分 31-45
  Level 3 (進階):     總分 46-60
  Level 4 (中階):     總分 61-75
  Level 5 (高階):     總分 76-85
  Level 6 (專業):     總分 86-95
  Level 7 (菁英):     總分 96-100
  ```
- [ ] 實作晉級檢測邏輯
- [ ] 生成等級徽章圖示

#### 里程碑 3.3: 進度報表系統

- [ ] 日報表

  - 今日訓練影片清單
  - 動作次數統計
  - 問題點數量變化
  - 今日重點改善項目
- [ ] 週報表

  - 訓練頻率統計
  - 各動作進步曲線
  - 六角圖對比 (本週 vs 上週)
  - 本週最佳表現動作
- [ ] 月報表

  - 成長趨勢圖
  - 等級變化歷程
  - 訓練時數統計
  - 月度改善建議
- [ ] 自動生成 PDF 報表

**可交付成果**:

- ✅ 能力評估 API (`GET /user/stats`)
- ✅ 報表生成系統 (日/週/月)
- ✅ 視覺化儀表板 (Web)

---

### Phase 4: RAG 知識庫 (4-5 週)

**目標**: 建立專家影片知識庫,提升分析準確性

#### 里程碑 4.1: 資料收集與清理

- [ ] 蒐集專家影片
  - 您的教練示範影片 (已有部分)
  - 職業拳手訓練影片 (YouTube / 公開資源)
  - 分級: 初學/中階/專業/世界級
- [ ] 影片標註
  - 動作類型
  - 選手等級
  - 技術特點標籤
- [ ] 提取特徵向量
  - 使用訓練好的姿態模型
  - 每個動作 → 128 維向量

#### 里程碑 4.2: 向量資料庫建立

- [ ] 選擇向量資料庫
  - **建議**: Pinecone (SaaS,簡單) 或 Chroma (開源)
- [ ] 建立索引
  - 動作類型索引
  - 等級索引
  - 混合搜索 (向量 + 元數據)
- [ ] 實作相似度搜尋
  ```python
  用戶動作 → 向量 → 搜尋最相似的專家動作 → 對比學習
  ```

#### 里程碑 4.3: RAG 整合

- [ ] 建立檢索增強流程
  ```
  用戶動作 → 檢索相似專家動作 → 
  生成對比分析 → GPT-4 生成建議
  ```
- [ ] 優化 Prompt
  - 提供專家動作參考
  - 提供技術要點說明
- [ ] A/B 測試
  - 有 RAG vs 無 RAG 的建議質量對比

**可交付成果**:

- ✅ 專家動作資料庫 (100+ 動作)
- ✅ 相似度搜尋 API
- ✅ RAG 增強的建議系統

---

### Phase 5: 3D 對戰模擬 (6-8 週)

**目標**: 遊戲化訓練體驗,提供策略分析

#### 里程碑 5.1: Unity 基礎建置

- [ ] Unity 專案初始化
- [ ] 拳擊角色建模
  - 使用 Mixamo 取得基礎角色
  - 實作 IK (Inverse Kinematics) 系統
- [ ] 拳館場景建置
  - 擂台、沙包、觀眾席
- [ ] 基礎動畫系統
  - 匯入標準拳擊動作動畫

#### 里程碑 5.2: 動作映射

- [ ] 將用戶姿態數據轉換為 Unity 動畫
  - MediaPipe 33 點 → Unity Humanoid 骨架
  - 座標系轉換
- [ ] 即時預覽功能
  - 上傳影片 → 3D 角色重現動作

#### 里程碑 5.3: AI 對手系統

- [ ] 設計對手等級
  ```
  Level 1: 防守弱,攻擊單調
  Level 2: 基礎連擊,防守改善
  Level 3: 會閃避,反擊快
  Level 4: 組合拳豐富,預判移動
  Level 5: 專業級,會利用用戶弱點
  ```
- [ ] 實作行為樹
  - 攻擊決策
  - 防守時機
  - 移動策略
- [ ] 對手弱點分析
  - 根據用戶六角圖設計針對性策略
  - 例如: 用戶步法弱 → 對手多用移動戰術

#### 里程碑 5.4: 對戰模擬邏輯

- [ ] 碰撞檢測系統
- [ ] 得分計算
  - 命中率
  - 有效傷害
  - 防守成功率
- [ ] 對戰報告生成
  - 勝負分析
  - 策略建議
  - 需加強項目

#### 里程碑 5.5: Unity WebGL 整合

- [ ] 編譯為 WebGL
- [ ] 嵌入 Web 前端
- [ ] 建立通訊橋接
  - JavaScript ↔ Unity C#
  - 傳遞用戶資料和對戰結果

**可交付成果**:

- ✅ 3D 對戰遊戲 (WebGL)
- ✅ 5+ 等級 AI 對手
- ✅ 策略分析報告

---

## 🎯 完整里程碑時間表

| 階段              | 時間       | 主要成果            | 可展示 Demo      |
| ----------------- | ---------- | ------------------- | ---------------- |
| **Phase 0** | Week 1-3   | 基礎架構 + 影片管理 | 自動掃描新影片   |
| **Phase 1** | Week 4-7   | 姿態分析 + 動作識別 | 影片 → 骨架動畫 |
| **Phase 2** | Week 8-12  | 問題檢測 + AI 建議  | 動作缺陷報告     |
| **Phase 3** | Week 13-15 | 能力評級 + 報表     | 六角圖 + 週報    |
| **Phase 4** | Week 16-20 | RAG 知識庫          | 專家動作對比     |
| **Phase 5** | Week 21-28 | 3D 對戰模擬         | 遊戲化訓練       |

**總計**: 約 6-7 個月完整開發

---

## 🔄 迭代開發策略

### Sprint 模式 (每 2 週一個 Sprint)

**Sprint 1-2**: Phase 0
**Sprint 3-4**: Phase 1.1 + 1.2
**Sprint 5**: Phase 1.3
**Sprint 6-8**: Phase 2
**Sprint 9-10**: Phase 3
**Sprint 11-13**: Phase 4
**Sprint 14-18**: Phase 5

每個 Sprint 結束:

1. ✅ Demo 可運作功能
2. ✅ 收集反饋
3. ✅ 調整下一 Sprint 計劃

---

## 📦 技術債務管理

### 必須在 MVP 完成的項目

- [ ] 單元測試 (覆蓋率 > 60%)
- [ ] API 文檔 (Swagger)
- [ ] 部署腳本 (Docker)
- [ ] 錯誤監控 (Sentry)
- [ ] 日誌系統

### 可延後的項目

- 行動 App (先專注 Web)
- 多人對戰
- 社群功能
- 付費訂閱系統

---

## 💰 成本預估

### 開發階段

- **AI API 費用**: GPT-4 Vision 約 $200-500/月
- **雲端儲存**: AWS S3 約 $50/月
- **向量資料庫**: Pinecone 免費版 → $70/月 (Pro)
- **伺服器**: AWS EC2 t3.medium $50/月

**總計**: 約 $300-700/月

### 未來營運

- 用戶量 < 100: 約 $500/月
- 用戶量 100-1000: 約 $2000-5000/月

---

## 🚀 上線策略

### Alpha 版 (自用)

- **時間**: Phase 3 完成後 (Week 15)
- **功能**: 影片分析 + 報表 + AI 建議
- **用戶**: 僅您自己

### Beta 版 (封測)

- **時間**: Phase 4 完成後 (Week 20)
- **功能**: + RAG 知識庫
- **用戶**: 邀請您的拳館同學 (5-10 人)

### 1.0 正式版

- **時間**: Phase 5 完成後 (Week 28)
- **功能**: 完整版 + 3D 對戰
- **用戶**: 對外公開 (與拳館合作)

---

## 📊 成功指標 (KPI)

### 技術指標

- [ ] 動作識別準確率 > 90%
- [ ] 影片處理速度 < 影片長度 2 倍
- [ ] API 回應時間 < 2 秒
- [ ] 系統正常運行時間 > 99%

### 產品指標

- [ ] 用戶每週上傳影片 ≥ 1 次
- [ ] 用戶查看報表頻率 ≥ 2 次/週
- [ ] AI 建議有用評分 > 4.0/5.0
- [ ] 3D 對戰遊玩時間 > 10 分鐘/次

---

## 🛡️ 風險管理

### 技術風險

| 風險                 | 影響 | 機率 | 緩解策略      |
| -------------------- | ---- | ---- | ------------- |
| MediaPipe 準確度不足 | 高   | 中   | 備用 OpenPose |
| GPT-4 成本過高       | 中   | 高   | 建立本地模型  |
| Unity 效能問題       | 中   | 中   | 簡化模型      |
| 影片處理速度慢       | 中   | 低   | GPU 加速      |

### 產品風險

| 風險          | 影響 | 機率 | 緩解策略       |
| ------------- | ---- | ---- | -------------- |
| AI 建議不準確 | 高   | 中   | RAG + 人工審核 |
| 用戶不信任 AI | 中   | 高   | 透明化指標     |
| 功能過於複雜  | 中   | 中   | 分階段發布     |

---

## 📝 下一步行動

### 本週行動項 (Week 1)

1. [X] 閱讀並確認此路線圖 (Day 0)
2. [X] 決定技術棧 (確認 MediaPipe / GPT-4) (Day 0)
3. [X] 設置開發環境 (Day 1)
4. [X] 安裝必要套件 (Day 1)
5. [X] 建立 Git Repository (Day 1)
6. [X] 測試 MediaPipe 在一支影片上 (Day 2)

### 下週行動項 (Week 2)

1. [X] 建立資料庫 Schema（含遷移與索引）
2. [X] 實作影片掃描腳本（排除 .heic、大小寫安全副檔名）
3. [X] 測試影片去重邏輯（生成重複/異常報告）
4. [X] 處理 10 支影片並檢視結果（E2E 驗證）

---

## 📞 決策點

### 需要您決定的事項

1. **預算上限**: 每月可接受的 API/雲端費用?
   回答: 目前規劃偏高，因為初期沒有營利，我會盡量用免費或本地版本
2. **上線時間壓力**: 是否有特定時間點要展示?
   回答:沒有特別壓力，不過希望有階段性展示，可以慢慢跟拳館討論
3. **技術偏好**: Python 為主? 或混合語言?
   回答: 都可以，我已Vibe Coding為主
4. **部署環境**: 本地伺服器 vs 雲端?
   回答: 初期本地Docker，等到穩定上線會用Cloud服務
5. **隱私考量**: 影片是否上傳雲端?
   回答: 可上傳，但要保護起來

---

## 📚 參考資源

### 研究論文

- [Model transfer from 2D to 3D for boxing pose estimation](https://www.frontiersin.org/journals/neurorobotics/articles/10.3389/fnbot.2023.1148545/full)
- [BoxMAC - A Boxing Dataset for Multi-label Action Classification](https://arxiv.org/html/2412.18204v1)
- [Real-Time Boxing Feedback Using Pose Estimation](http://www.diva-portal.org/smash/record.jsf?pid=diva2:1942090)

### 技術文件

- [MediaPipe Pose](https://google.github.io/mediapipe/solutions/pose.html)
- [Unity Machine Learning Agents](https://unity.com/products/machine-learning-agents)

---

**版本**: 1.0
**最後更新**: 2025-11-05
**負責人**: Product Manager + Technical Lead
**審核狀態**: 待確認

---

## ✅ 批准簽核

- [X] 產品負責人確認需求
- [X] 技術負責人確認可行性
- [X] 預算負責人確認成本
- [X] 開始執行 Phase 0
